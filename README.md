Этот репозиторий включает в себя:
- Код бекенда Кочерги (Django + Django REST Framework).
- Код фронтенда Кочерги (TypeScript + React + NextJS).
- docker-compose конфиги для деплоя.

# Организация разработки

## Как начать

1. Скачать код этого репозитория.
2. Установить docker и docker-compose.
3. **Наиболее сложный шаг:** сделать конфиг секретов для разработки на основе `sample_secrets.py`, положить в `backend/kocherga/django/settings/dev_secrets.py`. Вероятно, поправить `dev.py` там же. Для полнофункцинальной среды разработки нужно настроить много внешних сервисов. Хотя можно запускать без полных настроек и чинить части по ходу дела.
4. Запустить `make init-dev` для создания миграции базы.
5. Активировать среду разработки с помощью `make dev`. (Если у вас мак, то лучше использовать `make dev-mac` - в этом случае вспомогательные процессы типа webpаck'а запустятся вне контейнеров и у вас не будет проблем с перекомпиляцией по inotify).
6. Запустить `make test`, убедиться, что тесты проходятся.

## Ускорение для macOS

Производительность файловой системы в docker-контейнерах на macOS довольно фиговая.

Есть способ сделать быстрее:
* Установите docker-sync (`gem install docker-sync`).
* Установите foreman (`npm i -g foreman`).
* Используйте `make dev-mac` вместо `make dev` для запуска среды разработки.

Что поменяется:
1. render-server будет запущен вне контейнера (с помощью foreman; конфиг в `./docker/Procfile.mixed`; кастомизированный docker-compose конфиг в `./docker/compose.dev-mac.yml`).
2. Код будут синхронизироваться в контейнеры с помощью docker-sync.

## Выкладка изменений

Деплой организован с помощью GitLab CI, конфиг в файле `.gitlab-ci.yml`.

Изначальная настройка сервера делается с помощью ansible, см. репозиторий [deploy](https://gitlab.com/kocherga/code/deploy), роль `kocherga-core`.
