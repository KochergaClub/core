Этот репозиторий включает в себя:
- Код бекенда Кочерги (Django + Django REST Framework).
- Код фронтенда Кочерги (TypeScript + React + NextJS).
- k8s конфиги для разработки деплоя.

# Организация разработки

## Как начать

Скачать код этого репозитория.

Установить [skaffold](https://skaffold.dev/docs/install/).

Установить [minikube](https://kubernetes.io/docs/setup/learning-environment/minikube/) или каким-либо иным образом получить доступ к работающему kubernetes-кластеру.

В зависимости от того, будете ли вы собирать образы удалённо на кластере с помощью kaniko или локально:
- *Если вы собираетесь использовать kaniko:* получить доступ к реестру образов на GitLab, все образы хранятся там. Положить локально файл `docker.json` с параметрами доступа к реестру.
- *Если вы собираетесь использовать локальную сборку:* заменить в `skaffold.yaml` настройки kaniko на настройки для локальной сборки, то есть `local: {}`.

Дальше надо настроить конфиги.

В `k8s/dev/secrets` надо положить два файла:
- `db-passwords.env` с двумя строчками, `root_db_password=любой пароль` и `db_password=ещё один пароль`.
- `secrets.py` с параметрами для бекенда, можно написать на основе `sample_secrets.py`.

После этого можно запускать `skaffold dev --port-forward`.

Сайт поднимется по адресу `http://localhost:8000`.

## Выкладка изменений

Деплой организован с помощью GitLab CI, конфиг в файле `.gitlab-ci.yml`.

Изначальная настройка сервера делается с помощью ansible, см. репозиторий [deploy](https://gitlab.com/kocherga/code/deploy), роль `kocherga-core`.
