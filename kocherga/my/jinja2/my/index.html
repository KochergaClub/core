{% extends 'base.html' %}

{% block title %}Личный кабинет{% endblock %}

{% block content %}
<div>
  <h1>Личный кабинет Кочерги</h1>

  <div>
    Аккаунт: <code>{{ email }}</code>.
    <a href="/logout">Выйти</a>
  </div>

  {% if is_staff %}
  <div>
    <a href="{{ url('admin:index') }}">Перейти в админку</a>
  </div>
  {% endif %}

  {% if customer %}
    <h2>Посещения</h2>
    <p>
    Номер вашей карты: <strong>{{customer.card_id}}</strong>
    </p>
    {% if customer.subscription_until %}
    <p>Абонемент до <strong>{{ customer.subscription_until }}</strong>.
    {% endif %}

    {% if customer.last_visit %}
    <p>
      Последнее посещение:
      <strong>{{ customer.last_visit }}</strong>
    </p>
    {% endif %}
    <p>
      Всего вы были в Кочерге <strong>{{ orders|length }}</strong> раз.
    </p>
    <p>
      Суммарно вы потратили в Кочерге <strong>{{ customer.total_spent }}</strong> руб.
    </p>

    <section>
      <h3>Настройки приватности</h3>
      Ваше присутствие <strong>{% if customer.privacy_mode == 'public' %}отображается{% else %}не отображается{% endif %}</strong> на <a href="https://now.kocherga.club" >now.kocherga.club</a> и телевизорах в Кочерге.
      <form method="post" action="{{ url('my:set-privacy-mode') }}">
        {{ csrf_input }}
        <input type="hidden" value="{{ opposite_privacy_mode }}" name="privacy_mode">
        <input type="submit" value="{{ 'Отключить' if customer.privacy_mode == 'public' else 'Включить' }}">
      </form>
    </section>
  {% else %}
    <p>
      <i>
      Этот аккаунт не связан ни с какой клубной картой.
      <br>
      Если у вас есть клубная карта, возможно, она не привязана к этому email-адресу. Попросите администратора это исправить.
      </i>
    </p>
  {% endif %}
</div>
{% endblock %}
